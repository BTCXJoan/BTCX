<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>BTCX</title>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<style>
body {
  background:#0b0f1a;
  color:white;
  font-family:Arial;
  text-align:center;
  padding:40px;
}

.logo {
  width:140px;
  margin-bottom:20px;
}

.button {
  margin:10px;
  padding:12px 20px;
  background:#2563eb;
  border:none;
  color:white;
  border-radius:8px;
  cursor:pointer;
  display:block;
  width:260px;
  margin-left:auto;
  margin-right:auto;
}

.logout {
  background:#444;
}
</style>
</head>
<body>

<img src="btcx-logo.png" class="logo">

<h2>BTCX — Biblioteca Bitcoin</h2>

<!-- GRAFICO BTC -->
<div style="margin:30px auto; max-width:600px;">
<iframe src="https://s.tradingview.com/widgetembed/?symbol=BITSTAMP:BTCUSD&interval=D&theme=dark"
width="100%" height="300" frameborder="0"></iframe>
</div>

<button id="connectBtn" class="button">Conectar wallet</button>
<button id="logoutBtn" class="button logout" style="display:none;">Desconectar</button>

<div id="status"></div>

<div id="library" style="display:none;">

<a class="button" href="capitulo1.html">Capítulo 1</a>
<a class="button" href="capitulo2.html">Capítulo 2</a>
<a class="button" href="capitulo3.html">Capítulo 3</a>

</div>

<script>
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

interface IERC20 {
    function transferFrom(address sender, address recipient, uint256 amount) external returns (bool);
    function transfer(address recipient, uint256 amount) external returns (bool);
}

contract BTCXStaking {

    IERC20 public immutable btcx;

    uint256 public constant MIN_STAKE = 2000 * 1e18;
    uint256 public constant COOLDOWN = 7 days;

    struct StakeInfo {
        uint256 amount;
        uint256 unstakeTime;
    }

    mapping(address => StakeInfo) public stakes;
    uint256 public totalStaked;

    event Staked(address indexed user, uint256 amount);
    event UnstakeRequested(address indexed user, uint256 availableAt);
    event Unstaked(address indexed user, uint256 amount);

    constructor(address _btcx) {
        btcx = IERC20(_btcx);
    }

    function stake(uint256 amount) external {
        require(amount > 0, "Amount must be > 0");

        btcx.transferFrom(msg.sender, address(this), amount);

        stakes[msg.sender].amount += amount;
        totalStaked += amount;

        require(stakes[msg.sender].amount >= MIN_STAKE, "Below minimum stake");

        emit Staked(msg.sender, stakes[msg.sender].amount);
    }

    function requestUnstake() external {
        require(stakes[msg.sender].amount > 0, "Nothing staked");
        require(stakes[msg.sender].unstakeTime == 0, "Already requested");

        stakes[msg.sender].unstakeTime = block.timestamp + COOLDOWN;

        emit UnstakeRequested(msg.sender, stakes[msg.sender].unstakeTime);
    }

    function unstake() external {
        StakeInfo memory info = stakes[msg.sender];

        require(info.unstakeTime > 0, "Unstake not requested");
        require(block.timestamp >= info.unstakeTime, "Cooldown active");

        uint256 amount = info.amount;

        delete stakes[msg.sender];
        totalStaked -= amount;

        btcx.transfer(msg.sender, amount);

        emit Unstaked(msg.sender, amount);
    }

    function hasAccess(address user) external view returns (bool) {
        return stakes[user].amount >= MIN_STAKE && stakes[user].unstakeTime == 0;

}else{

document.getElementById("status").innerHTML="No tienes acceso activo";

}

}

function logout(){

document.getElementById("library").style.display="none";
document.getElementById("connectBtn").style.display="inline-block";
document.getElementById("logoutBtn").style.display="none";
document.getElementById("status").innerHTML="Desconectado";

}

document.getElementById("connectBtn").onclick = connectWallet;
document.getElementById("logoutBtn").onclick = logout;
</script>

</body>
</html>
