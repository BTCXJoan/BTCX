<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>BTCX</title>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<style>
body { background:#0b0f1a; color:white; font-family:Arial; text-align:center; padding:40px; }
.logo { width:140px; margin-bottom:20px; }

.button {
  margin:12px auto; padding:14px; background:#2563eb;
  border:none; color:white; border-radius:8px;
  cursor:pointer; display:block; width:320px;
  text-decoration:none;
}

.box {
  max-width:500px;
  margin:20px auto;
  background:#111827;
  padding:15px;
  border-radius:8px;
}

.logout { background:#444; }
</style>
</head>
<body>

<!-- PANTALLA PUBLICA -->

<div id="publicView">

<img src="btcx-logo.png" class="logo">
<h2>BTCX — Biblioteca Bitcoin</h2>

<div class="box">
<p>
Para acceder al contenido necesitas mantener un mínimo de
<strong>2.000 BTCX</strong> en staking.
</p>

<p>
Actualmente BTCX se distribuye directamente por el proyecto.
Si estás interesado puedes solicitar acceso.
</p>

<p style="opacity:0.7;">
Una vez tengas BTCX en tu wallet podrás conectarte aquí.
</p>
</div>

<button id="connectBtn" class="button">Conectar wallet</button>

<div id="message"></div>

</div>

<!-- PANEL PRIVADO -->

<div id="privateView" style="display:none;">

<h2>Acceso concedido ✔</h2>

<a class="button" href="capitulo1.html">Capítulo 1</a>
<a class="button" href="capitulo2.html">Capítulo 2</a>
<a class="button" href="capitulo3.html">Capítulo 3</a>

<button id="logoutBtn" class="button logout">Desconectar</button>

</div>

<script>

const stakingAddress="0xFc9016F9153D0a7e9A09DDca7Ad756F9485cEcbc";

const stakingABI=[
 "function hasAccess(address user) view returns(bool)"
];

async function connectWallet(){

 if(!window.ethereum){
   alert("Necesitas MetaMask");
   return;
 }

 try{

 const provider=new ethers.providers.Web3Provider(window.ethereum);
 await provider.send("eth_requestAccounts",[]);
 const signer=provider.getSigner();
 const user=await signer.getAddress();

 const contract=new ethers.Contract(stakingAddress,stakingABI,provider);
 const access=await contract.hasAccess(user);

 if(access){

   localStorage.setItem("btcxConnected","true");

   document.getElementById("publicView").style.display="none";
   document.getElementById("privateView").style.display="block";

 }else{

   document.getElementById("message").innerHTML =
   "Esta wallet no tiene staking activo de 2.000 BTCX.";

 }

 }catch(e){
   document.getElementById("message").innerHTML =
   "Error conectando wallet.";
 }

}

function logout(){
 localStorage.removeItem("btcxConnected");
 document.getElementById("privateView").style.display="none";
 document.getElementById("publicView").style.display="block";
}

document.getElementById("connectBtn").onclick=connectWallet;
document.getElementById("logoutBtn").onclick=logout;

window.onload=async()=>{
 if(localStorage.getItem("btcxConnected")==="true"){
   await connectWallet();
 }
};

</script>

</body>
</html>
